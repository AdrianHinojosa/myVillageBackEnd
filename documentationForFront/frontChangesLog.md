# Front-End Changes Log

This document tracks field name differences between the front-end and back-end so the front-end team knows what adjustments are needed.

---

## General Conventions

| Convention | Front-End | Back-End | Notes |
|---|---|---|---|
| Date prefix | `dt` (e.g. `dtStartDate`) | `t` (e.g. `tStartDate`) | Front-end must map `dt` → `t` when **sending** to API; rename `t` → `dt` when **reading** from API |
| Timestamps | `dtCreatedAt`, `dtUpdatedAt` | `created_at`, `updated_at` | Knex auto-generates snake_case; front-end must read `created_at` / `updated_at` |
| ID convention | Matches back-end | `s{TableName}Id` | e.g. `sStudentId`, `sGoalId`, `sGoalTaskId` |

---

## Schools Module

| Front-End Field | Back-End Field | Notes |
|---|---|---|
| `sAdminName` (single field) | `sName`, `sLastName`, `sSecondLastName` | Front-end should split into 3 separate fields for User creation |
| `sAdminEmail` | `sEmail` | Used for User creation (not School table) |
| `oLogo` (file upload) | `sImageKey` (S3 key) | Front-end uploads file via `POST /schools/image`; back-end stores S3 key |
| `iUsers`, `iStudents` (computed) | Not stored fields | Computed via COUNT queries in getAllSchools response |

---

## Students Module

| Front-End Field | Back-End Field | Notes |
|---|---|---|
| `sBirthYear` (string in form) | `iBirthYear` (integer) | Already handled — `StudentForm.vue` calls `parseInt(sBirthYear, 10)` and emits `iBirthYear` before submitting |
| `dtCreatedAt` | `created_at` | Timestamp auto-generated by Knex (snake_case) |
| `dtUpdatedAt` | `updated_at` | Timestamp auto-generated by Knex (snake_case) |

### Computed fields — returned by back-end, no action needed from front-end:
- `sFullName` — computed as `TRIM(CONCAT_WS(' ', sName, sLastName, sSecondLastName))`
- `iAge` — computed as `EXTRACT(YEAR FROM NOW()) - iBirthYear`
- `iGoalsCount` — correlated subquery counting active goals for the student
- `dGoalsProgress` — average `dProgress` across active goals (integer, 0–100)

All other fields match: `sStudentId`, `sName`, `sLastName`, `sSecondLastName`, `sGrade`, `sGroup`, `sDiagnosis`, `sNotes`, `bActive`

---

## Goals Module

### Field name mapping

| Front-End Field | Back-End Field | Action |
|---|---|---|
| `dtStartDate` | `tStartDate` | Send `tStartDate`, read `tStartDate` |
| `dtTargetDate` | `tTargetDate` | Send `tTargetDate`, read `tTargetDate` |
| `dtCompletedDate` | `tCompletedDate` | Read only — set by back-end on complete |
| `dtLastRecord` | `tLastRecord` | Read only — set by back-end when recording |
| `dtCreatedAt` | `created_at` | Read only — Knex auto-generated |
| `dtUpdatedAt` | `updated_at` | Read only — Knex auto-generated |

### Tasks relation key

| Front-End Field | Back-End Field | Notes |
|---|---|---|
| `oGoal.aTasks` | `oGoal.GoalTasks` | Back-end returns tasks under the key `GoalTasks` (array). Front-end must access `oGoal.GoalTasks`, not `oGoal.aTasks` |

### Create Goal — missing field

When calling `POST /goals`, the front-end **must include `sStudentId`** in the request body.
In `add.vue`, `sStudentId` must be injected from `this.$route.params.id` into the form data before submitting.

```js
// In add.vue handleSubmit:
const payload = {
  ...oFormData,
  sStudentId: this.$route.params.id,
  tStartDate: oFormData.dtStartDate,   // rename dt → t
  tTargetDate: oFormData.dtTargetDate, // rename dt → t
};
```

### Complete Goal — field mapping

`GoalCompleteDialog` currently emits `{ sResult, sNotes }`. The API endpoint `PATCH /goals/:sGoalId/complete` expects:

| Dialog emit field | API body field | Mapping |
|---|---|---|
| `sResult: 'ACHIEVED'` | `sStatus: 'COMPLETED'` | Map string value |
| `sResult: 'NOT_ACHIEVED'` | `sStatus: 'NOT_ACHIEVED'` | No mapping needed |
| `sNotes` | `sCompletionNotes` | Rename field |

```js
// In [goalId]/index.vue handleCompleteGoal:
const payload = {
  sStatus: oResult.sResult === 'ACHIEVED' ? 'COMPLETED' : 'NOT_ACHIEVED',
  sCompletionNotes: oResult.sNotes || undefined,
};
await $fetch(`/api/goals/${sGoalId}/complete`, { method: 'PATCH', body: payload });
```

### Documents (aDocuments)

`aDocuments` sent in create/update goal body is **ignored** by the back-end. Remove `aDocuments` from the goals form submission payload.

GoalFiles routes are mounted at `/:sGoalId/goalFiles`. Upload endpoint: `POST /goals/:sGoalId/goalFiles`

All other fields match: `sGoalId`, `sStudentId`, `sTitle`, `sDescription`, `sMeasurementType`, `sStatus`, `iTargetValue`, `iTargetDuration`, `iScaleMin`, `iScaleMax`, `sFrequencyUnit`, `dProgress`, `dAverageValue`, `iRecordsCount`, `sCompletionNotes`

---

## GoalTasks Module

| Front-End Field | Back-End Field | Notes |
|---|---|---|
| `sTaskId` | `sGoalTaskId` | Back-end follows `s{TableName}Id` convention |

All other fields match: `sTitle`, `bCompleted`, `iOrder`

---

## GoalFiles Module

Fields match the standard Files pattern: `sGoalFileId`, `sGoalId`, `sFileKey`, `sFileName`, `sFileType`
